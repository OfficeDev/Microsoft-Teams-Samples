@page
@model TabInStageView.Models.TabInfoAction

<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://res.cdn.office.net/teams-js/2.34.0/js/MicrosoftTeams.min.js"
            integrity="sha384-brW9AazbKR2dYw2DucGgWCCcmrm2oBFV4HQidyuyZRI/TnAkmOOnTARSTdps3Hwt"
            crossorigin="anonymous">
    </script>
    <script>
        // App Initilize
        microsoftTeams.app.initialize();

        function createLink() {

            // Client id
            var appId = '@(ViewBag.AppId)';

            // Get thread id by this format "19:***********thread.v2";
            var threadId = "@TabInStageView.Bots.ActivityBot._threadId";

            // Application base url and this redirects to Index view
            var contentUrl = window.location.origin;

            var context = {
                appId: appId,
                contentUrl: contentUrl,
                websiteUrl: contentUrl,
                name: "DemoStageView",
                openMode: "popoutWithChat",
                threadId:threadId
            }

            const encodedContext = encodeURIComponent(JSON.stringify(context));

            // Passing the values and encoding the url while implementing the deeplink from tab
            let url = "https://teams.microsoft.com/l/stage/" + appId + "/0?context=" + encodedContext;

            console.log("eoncoded URL",url);

            microsoftTeams.app.openLink(url);
        };

        function popOut() {

            // Client id
            var appId = '@(ViewBag.AppId)';

            // Get thread id by this format "19:***********thread.v2";
            var threadId = "@TabInStageView.Bots.ActivityBot._threadId";

            // Application base url and this redirects to Index view
            var contentUrl = window.location.origin;

            var context = {
                appId: appId,
                contentUrl: contentUrl,
                websiteUrl: contentUrl,
                name: "DemoStageView",
                openMode: "popout",
                threadId: threadId
            }

            const encodedContext = encodeURIComponent(JSON.stringify(context));

            // Passing the values and encoding the url while implementing the deeplink from tab
            let url = "https://teams.microsoft.com/l/stage/" + appId + "/0?context=" + encodedContext;

            console.log("eoncoded URL", url);

            microsoftTeams.app.openLink(url);
        };

        function model() {

            // Client id
            var appId = '@(ViewBag.AppId)';

            // Get thread id by this format "19:***********thread.v2";
            var threadId = "@TabInStageView.Bots.ActivityBot._threadId";

            // Application base url and this redirects to Index view
            var contentUrl = window.location.origin;

            var context = {
                appId: appId,
                contentUrl: contentUrl,
                websiteUrl: contentUrl,
                name: "DemoStageView",
                openMode: "model",
                threadId: threadId
            }

            const encodedContext = encodeURIComponent(JSON.stringify(context));

            // Passing the values and encoding the url while implementing the deeplink from tab
            let url = "https://teams.microsoft.com/l/stage/" + appId + "/0?context=" + encodedContext;

            console.log("eoncoded URL", url);

            microsoftTeams.app.openLink(url);
        };
    </script>
</head>

<body class="theme-light">
    <div class="surface">
        <div class="panel">
            <div>
                <label for="tabChoice"></label>Click on the button to view the stage view from deeplink:
                <button onClick="createLink()">Execute deeplink PopOutWithChat</button>
                <button onClick="popOut()">OpenMode Popout</button>
                <button onClick="model()">OpenMode Model</button>
            </div>
        </div>
    </div>
</body>

</html>