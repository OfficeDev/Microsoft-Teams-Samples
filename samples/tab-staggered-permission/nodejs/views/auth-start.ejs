<head>
    <script src="https://res.cdn.office.net/teams-js/2.5.0/js/MicrosoftTeams.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://alcdn.msauth.net/browser/2.24.0/js/msal-browser.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
     <script type="text/javascript">
         let data = <%-data%>
         $(document).ready(function () {
            getAuthToken(data.clientId);
        });
       
        // Get auth token.
        function getAuthToken(clientId) {
             var clientId = clientId;
             const scope = data.scope;
            if (clientId != undefined && clientId != null && clientId !== '') {
                microsoftTeams.app.initialize().then(() => {
                    // Get the tab context, and use the information to navigate to Azure AD login page
                    microsoftTeams.app.getContext().then(async (context) => {
                        var currentURL = new URL(window.location);
                        var loginHint = context.user.loginHint;
						
                        const msalConfig = {
                            auth: {
                                clientId: clientId,
                                authority: `https://login.microsoftonline.com/${context.user.tenant.id}`,
                                navigateToLoginRequestUrl: false
                            },
                            cache: {
                                cacheLocation: "sessionStorage",
                            },
                        };
						
                        const msalInstance = new msal.PublicClientApplication(msalConfig);
						
                        const scopesArray = scope.split(" ");
                        const scopesRequest = {
                            scopes: scopesArray,
                            redirectUri: window.location.origin + `/auth-end`,
                            loginHint: loginHint
                        };
						
                        await msalInstance.loginRedirect(scopesRequest);
                    });
                });
            }
        }
    </script>
</head>
<body class="theme-light">
</body>
